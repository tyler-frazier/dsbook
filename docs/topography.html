<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Accessibility 3 - Population and Development Data Science</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="book.html">About this book</a></li><li class="expanded affix "><a href="author.html">About the author</a></li><li class="expanded "><a href="getting_started.html"><strong aria-hidden="true">1.</strong> Student Preparations</a></li><li><ol class="section"><li class="expanded "><a href="gitstart.html"><strong aria-hidden="true">1.1.</strong> Getting Started with GitHub, Markdown &amp; Webstorm</a></li><li class="expanded "><a href="manager.html"><strong aria-hidden="true">1.2.</strong> Getting Started with Homebrew or Chocolatey</a></li><li class="expanded "><a href="rstart.html"><strong aria-hidden="true">1.3.</strong> Getting Started with R &amp; RStudio</a></li><li class="expanded "><a href="pystart.html"><strong aria-hidden="true">1.4.</strong> Getting Started with Python &amp; Pycharm</a></li></ol></li><li class="expanded "><a href="datause.html"><strong aria-hidden="true">2.</strong> Data Use for Human and Community Scale Development Processes</a></li><li><ol class="section"><li class="expanded "><a href="describe.html"><strong aria-hidden="true">2.1.</strong> Spatial Population Description</a></li><li class="expanded "><a href="model.html"><strong aria-hidden="true">2.2.</strong> Spatial Population Modelling</a></li><li class="expanded "><a href="defacto_descript.html"><strong aria-hidden="true">2.3.</strong> Accessibility 1</a></li><li class="expanded "><a href="transport_health.html"><strong aria-hidden="true">2.4.</strong> Accessibility 2</a></li><li class="expanded "><a href="topography.html" class="active"><strong aria-hidden="true">2.5.</strong> Accessibility 3</a></li></ol></li><li class="expanded "><a href="abm.html"><strong aria-hidden="true">3.</strong> Simulating Human Development Processes from Neighborhood to Regional Scales</a></li><li><ol class="section"><li class="expanded "><a href="siteselect.html"><strong aria-hidden="true">3.1.</strong> Project 1: Site Selection</a></li><li class="expanded "><a href="synpop.html"><strong aria-hidden="true">3.2.</strong> Project 2: Generating Synthetic Populations</a></li><li class="expanded "><a href="gravity.html"><strong aria-hidden="true">3.3.</strong> Project 3: Transportation Model</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Population and Development Data Science</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#rendering-topography" id="rendering-topography">Rendering Topography</a></h1>
<p>In this last project, you will revist the de facto urban areas you defined as well as the transportation infrastructure and health care facilites you spatially located.  Using your combined adm2 or adm3, you will intersect those land use, transport and health care geographies with the topography of your selected adm2 or adm3.  You may recall that we used the <code>rayshader::</code> package back in project 1, which we will use again, but this time will focus on its application with rasters rather than starting with a <code>sf</code> object.</p>
<p>To start, be certain you have the <code>raster::</code>,<code>sf::</code> and <code>tidyverse::</code> library of functions available for your current R worksession.  Also, install and load the <code>rayshader::</code> and <code>rayrender::</code> packages.</p>
<pre><code class="language-text">#install.packages(&quot;rayshader&quot;, dependencies = TRUE)

library(raster)
library(sf)
library(tidyverse)

library(rayshader)
library(rayrender)
</code></pre>
<p>Use the <code>setwd()</code> command to make certain your working directory is set to the data folder where you saved your raster and shapefiles.  Read your raster file that describes the topography throughout your LMIC into RStudio.  Also read the shapefile of your adm2 or adm3s as a simple features object into RStudio.  Following are my examples for Liberia.</p>
<pre><code class="language-text">lbr_topo &lt;- raster(&quot;lbr_srtm_topo_100m.tif&quot;)
lbr_adm2  &lt;- read_sf(&quot;gadm36_LBR_2.shp&quot;)
</code></pre>
<p>With the polygon you previously created by unioning the two adm2s or adm3s you selected, use the <code>crop()</code> command to crop the raster describing the topography of your LMIC.  You could also <code>mask()</code> the topographical raster, but I am going to forego that step in favor of retaining the area within the bounding box used by the <code>sf</code> from my combined adm2.</p>
<pre><code class="language-text">combined_topo &lt;- crop(lbr_topo, combined_adm2s)
</code></pre>
<p>Next you will convert your cropped raster into a matrix using the <code>raster_to_matrix()</code> command from the <code>rayshader::</code> library of functions.  When executing this function, R will return the dimensions of the matrix created.  Take note of these dimensions, since you will later need them to specify the width and height, in pixels, of the image you will produce of your urban areas, roads and health care that you will then overlay your topography.</p>
<p><img src="images/screen-shot-2019-11-18-at-12.05.00-am.png" alt="" /></p>
<p>Using the <code>sphere_shade()</code> command from the <code>rayshader::</code> library, plot your topography.  Use the <code>add_water()</code> and <code>detect_water()</code> commands to automatically add water features to your plot.  My initial plot is primarily rain forest, and water features aren't readily apparent.  Yours may or may not have water features, depending on the location.</p>
<pre><code class="language-text">combined_matrix %&gt;%
  sphere_shade() %&gt;%
  add_water(detect_water(combined_matrix)) %&gt;%
  plot_map()
</code></pre>
<p>The resulting plot is a two dimension relief of the bounding box encompassing your combined adm2 or adm3s.</p>
<p><img src="images/rplot05.png" alt="" /></p>
<p>To produce a three-dimension plot of your selected area, first apply the <code>ambient_shade()</code> command to your topography matrix.</p>
<pre><code class="language-text">ambientshadows &lt;- ambient_shade(combined_matrix)
</code></pre>
<p>Producing these shadows may take a few minutes, but once it is complete, you are ready to begin producing your three-dimension topographic plot.  There are lots of options you can use to produce your 3D plot.  Following is a basic specification.</p>
<pre><code class="language-text">combined_matrix %&gt;%
  sphere_shade() %&gt;%
  add_water(detect_water(combined_matrix), color = &quot;lightblue&quot;) %&gt;%
  add_shadow(ray_shade(combined_matrix, sunaltitude = 3, zscale = 33, lambert = FALSE), max_darken = 0.5) %&gt;%
  add_shadow(lamb_shade(combined_matrix, sunaltitude = 3, zscale = 33), max_darken = 0.7) %&gt;%
  add_shadow(ambientshadows, max_darken = 0.1) %&gt;%
  plot_3d(combined_matrix, zscale = 20,windowsize = c(1000,1000), 
          phi = 40, theta = 135, zoom = 0.5, 
          background = &quot;grey30&quot;, shadowcolor = &quot;grey5&quot;, 
          soliddepth = -50, shadowdepth = -100)
</code></pre>
<p>Using the <code>render_snapshop()</code> command, produce a three dimesnional image similar to the following for your selected and combined adm2s.</p>
<pre><code class="language-text">render_snapshot(title_text = &quot;Sanniquelleh-Mahn &amp; Saclepea, Liberia&quot;, 
                title_size = 50,
                title_color = &quot;grey90&quot;)
</code></pre>
<p><img src="images/rplot%20%281%29.png" alt="" /></p>
<p>The <code>sphere_shade(texture = ...)</code> command presents other options such as  <code>texture = &quot;desert&quot;</code> .  To review all of the texture options, type <code>?sphere_shade</code> in the console.  Test each option out to determine which one best matches the physical geography of your selected area.</p>
<p>Return to the plot produced at the end of project 3.  Use <code>ggplot()</code> to produce a border of your combined adm2s.  Set the size, linetype and color appropriate for a border.  Also set the <code>alpha = 0</code> such that the plot is transparent.  Notice at the end I have added several arguments that effectively remove the axes, the gridded background, labels and expands the plot itself to its boundary in order to maximize the total plot area.</p>
<pre><code class="language-text">ggplot() +
  geom_sf(data = combined_adm2s,
          size = 4.5,
          linetype = &quot;11&quot;,
          color = &quot;gold&quot;,
          alpha = 0) +
  theme_void() + theme(legend.position=&quot;none&quot;) +
  scale_x_continuous(expand=c(0,0)) +
  scale_y_continuous(expand=c(0,0)) +
  labs(x=NULL, y=NULL, title=NULL)
</code></pre>
<p>Use the script above to produce a similar plot for your selected adm2 within your LMIC.</p>
<p><img src="images/rplot01%20%287%29.png" alt="" /></p>
<p>Now, instead of producing the plot in R, modify the first line of the code in order to assign the ggplot to an object.</p>
<pre><code class="language-text">obj &lt;- ggplot() + ...
</code></pre>
<p>Then use the <code>png()</code> command to create your graphic object.  Set the <code>width =</code> and <code>height =</code> to the same dimensions previously returned by the <code>raster_to_matrix()</code> command.  Set the <code>units =</code>  to pixels, and also set the <code>bg =</code> arugment to transparent, so only the lines themselve appear without any background in your <code>.png</code> file. </p>
<pre><code class="language-text">png(&quot;combined.png&quot;, width = 920, height = 1136, units = &quot;px&quot;, bg = &quot;transparent&quot;)
obj
dev.off()
</code></pre>
<p>After you have saved your <code>.png</code> graphics file to your working directory, use the <code>readPNG()</code> command from the <code>png::</code> library and import your image.  Once it has been imported to R, add the <code>add_overlay()</code> command, in order to overlay the dashed, gold border of your combined adm2s.</p>
<pre><code class="language-text">overlay_img &lt;- png::readPNG(&quot;combined.png&quot;)

combined_matrix %&gt;%
  sphere_shade() %&gt;%
  add_water(detect_water(combined_matrix)) %&gt;%
  add_overlay(overlay_img, alphalayer = 0.95) %&gt;%
  plot_map()
</code></pre>
<p><img src="images/rplot05%20%282%29.png" alt="" /></p>
<p>Likewise, add the <code>add_overlay()</code> command when producing your three-dimension plot.</p>
<pre><code class="language-text">combined_matrix %&gt;%
  sphere_shade() %&gt;%
  add_water(detect_water(combined_matrix), color = &quot;lightblue&quot;) %&gt;%
  add_shadow(ray_shade(combined_matrix, sunaltitude = 3, zscale = 33, lambert = FALSE), max_darken = 0.5) %&gt;%
  add_shadow(lamb_shade(combined_matrix, sunaltitude = 3, zscale = 33), max_darken = 0.7) %&gt;%
  add_shadow(ambientshadows, max_darken = 0.1) %&gt;%
  add_overlay(overlay_img, alphalayer = 0.95) %&gt;%
  plot_3d(combined_matrix, zscale = 20,windowsize = c(1000,1000), 
          phi = 40, theta = 135, zoom = 0.75, 
          background = &quot;grey30&quot;, shadowcolor = &quot;grey5&quot;, 
          soliddepth = -50, shadowdepth = -100)
</code></pre>
<p>Modifying the <code>alphalayer =</code> argument will set the transparency of the combined adm2s border.  Increasing the <code>zoom =</code>  argument will move your perspective in the three-dimension plot further away from your rendered object.  Modifying the <code>phi =</code> and <code>theta =</code>  parameters will also alter the viewers perspective by orbiting the camera around the scene or changing the angle of the camera above the horizon.  Once you plot the image, again use the <code>render_snapshot()</code> to save your image.  If you would like to make some changes and replot, first run <code>rgl::rgl.clear()</code> to clear your existing rgl object.</p>
<p><img src="images/rplot06%20%282%29.png" alt="" /></p>
<p>Add the boundaries of your de facto urban areas to your <code>ggplot</code> object and again create your <code>.png</code> file.</p>
<pre><code class="language-text">obj &lt;- ggplot() +
  geom_sf(data = combined_adm2s,
          size = 5.0,
          linetype = &quot;11&quot;,
          color = &quot;gold&quot;,
          alpha = 0) +
  geom_sf(data = combined_polys,
          size = 0.75,
          color = &quot;gray50&quot;,
          fill = &quot;gold3&quot;,
          alpha = 0.5) +
  theme_void() + theme(legend.position=&quot;none&quot;) +
  scale_x_continuous(expand=c(0,0)) +
  scale_y_continuous(expand=c(0,0)) +
  labs(x=NULL, y=NULL, title=NULL)

png(&quot;combined.png&quot;, width = 920, height = 1136, units = &quot;px&quot;, bg = &quot;transparent&quot;)
obj
dev.off()
</code></pre>
<p>Again, run the <code>readPNG()</code> command to reimport your <code>.png</code> file as an object.</p>
<pre><code class="language-text">overlay_img &lt;- png::readPNG(&quot;combined.png&quot;)
</code></pre>
<p>Produce your three-dimensional plot with borders and urban areas.</p>
<p><img src="images/rplot02%20%284%29.png" alt="" /></p>
<p>Next add your roads.</p>
<p><img src="images/rplot03%20%282%29.png" alt="" /></p>
<p>Then add your health care facilities.</p>
<p><img src="images/rplot04%20%284%29.png" alt="" /></p>
<p>Finally, label the primary urban area.  You will need to modify the <code>x =</code>  and <code>y =</code>  argument to properly place the label.</p>
<pre><code class="language-text">render_label(combined_matrix, &quot;Ganta&quot;, textcolor =&quot;white&quot;, linecolor = &quot;white&quot;, 
             x = 250, y = 575, z = 1000, textsize = 2.5, linewidth = 4, zscale = 10)
</code></pre>
<p><img src="images/rplot07%20%281%29.png" alt="" /></p>
<h2><a class="header" href="#project-4-individual-and-group-deliverable" id="project-4-individual-and-group-deliverable">Project 4. Individual and Group Deliverable</a></h2>
<p>Produce a three-dimensional, topographic plot that describes the <em>de facto</em> boundaries of urban areas, the center lines of classified roadways and the location of health care facilities by type throughout your selected and combined adm2, adm3 or adm4 areas.  Combine your plot with each of your team members, and provide a single written statement that compares each of the selected adm2 areas, while also considering the following.</p>
<ol>
<li>How has topography appeared to have impacted the development of urban areas?</li>
<li>How has topography appeared to have impacted the development of transportation facilities?</li>
<li>How has topography appeared to have impacted the location of health care facilities?</li>
<li>Has producing your three-dimensional map resulted in an interpretion that is different from your previous analysis?</li>
</ol>
<p>Upload your group's finished product to the slack channel #data100_project4 no later than midnight on Thursday, April 30th.  Your team will present an extended, comparison of your selected administrative areas within each LMIC, during the final group presentation, held on May 1st.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="transport_health.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="abm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="transport_health.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="abm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
